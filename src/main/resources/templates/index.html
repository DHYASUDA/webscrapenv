<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>AQI Comparison</title>
    <link rel="stylesheet" href="/css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <h1>Air Quality Index (AQI) Comparison</h1>

    <form th:action="@{/api/AQITEST}" method="post">
        <label for="city1">Select City 1:</label>
        <select id="city1" name="city1">
            <option th:each="city : ${#lists.list('Chicago', 'Los Angeles', 'San Francisco', 'Houston', 'Phoenix', 'New York', 'Philadelphia', 'Austin', 'Dallas', 'Miami', 'Toronto', 'Honolulu', 'Galveston', 'Bogota', 'Tokyo', 'London', 'Paris', 'Rome', 'Berlin', 'Stockholm', 'Dublin', 'Beijing', 'Lima')}"
                    th:value="${city}" th:text="${city}"></option>
        </select>

        <label for="city2">Select City 2:</label>
        <select id="city2" name="city2">
            <option th:each="city : ${#lists.list('Chicago', 'Los Angeles', 'San Francisco', 'Houston', 'Phoenix', 'New York', 'Philadelphia', 'Austin', 'Dallas', 'Miami', 'Toronto', 'Honolulu', 'Galveston', 'Bogota', 'Tokyo', 'London', 'Paris', 'Rome', 'Berlin', 'Stockholm', 'Dublin', 'Beijing', 'Lima')}"
                    th:value="${city}" th:text="${city}"></option>
        </select>

        <button type="submit">Compare</button>
    </form>

    <div th:if="${city1Name != null and city1AQI != null}">
        <h2>City 1: <span th:text="${city1Name}">Unknown</span></h2>
        <p>AQI: <span th:text="${city1AQI != -1} ? ${city1AQI} : 'Data unavailable'">Unknown</span></p>
    </div>
    <div th:if="${city2Name != null and city2AQI != null}">
        <h2>City 2: <span th:text="${city2Name}">Unknown</span></h2>
        <p>AQI: <span th:text="${city2AQI != -1} ? ${city2AQI} : 'Data unavailable'">Unknown</span></p>
    </div>

    <div th:if="${citiesAQI?.isEmpty() != true}">
        <h2>AQI Graph for All Cities</h2>
        <canvas id="aqiChart" width="800" height="400"></canvas>
        <script>
            const ctx = document.getElementById('aqiChart').getContext('2d');
            const aqiChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [
                        /* th:each="cityData, iterStat : ${citiesAQI}" */
                        /* th:text="${cityData.city}" */
                        /* th:if="${iterStat.last}" */ /* th:text="${cityData.city}" */
                        /* th:unless="${iterStat.last}" */ /* th:text="${cityData.city + ','}" */
                    ],
                    datasets: [{
                        label: 'AQI',
                        data: [
                            /* th:each="cityData, iterStat : ${citiesAQI}" */
                            /* th:text="${cityData.aqi}" */
                            /* th:if="${iterStat.last}" */ /* th:text="${cityData.aqi}" */
                            /* th:unless="${iterStat.last}" */ /* th:text="${cityData.aqi + ','}" */
                        ],
                        backgroundColor: [
                            /* th:each="cityData, iterStat : ${citiesAQI}" */
                            /* th:text="${cityData.aqi == -1} ? '\'gray\'' : '\'rgba(75, 192, 192, 0.2)\'" */
                            /* th:if="${iterStat.last}" */ /* th:text="${cityData.aqi == -1} ? '\'gray\'' : '\'rgba(75, 192, 192, 0.2)\'" */
                            /* th:unless="${iterStat.last}" */ /* th:text="${cityData.aqi == -1} ? '\'gray\',' : '\'rgba(75, 192, 192, 0.2)\','" */
                        ],
                        borderColor: [
                            /* th:each="cityData, iterStat : ${citiesAQI}" */
                            /* th:text="${cityData.aqi == -1} ? '\'gray\'' : '\'rgba(75, 192, 192, 1)\'" */
                            /* th:if="${iterStat.last}" */ /* th:text="${cityData.aqi == -1} ? '\'gray\'' : '\'rgba(75, 192, 192, 1)\'" */
                            /* th:unless="${iterStat.last}" */ /* th:text="${cityData.aqi == -1} ? '\'gray\',' : '\'rgba(75, 192, 192, 1)\','" */
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'AQI Value'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Cities'
                            }
                        }
                    }
                }
            });
        </script>
    </div>
    <div th:if="${citiesAQI == null or citiesAQI.isEmpty()}">
        <p>No AQI data available for graphing.</p>
    </div>
</body>
</html>